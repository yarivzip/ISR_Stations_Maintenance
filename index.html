<!DOCTYPE html>
<html>
	<title>&nbsp;</title>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="../Cordova/cordova.js"></script>
	</head>
	
	<body>
		

	
		<!-- Start of first page I -->
		<div data-role="page" id="page1" dir="rtl">
			<!-- Header -->
			<div data-role="header">
				<a href="#settings_page" class="ui-btn-right" data-transition="slide" data-direction="reverse" data-icon="gear">הגדרות</a>
		
				<h1>בדיקת תחנות</h1>

			</div>
			<!-- /header -->
			<!-- Content    -->
			<div data-role="content">
				<h3>הזן מספר תחנה</h3>
				<input type="number" step="1" id="inptStationNumber"/> 
				<p>
					<h3>נא סמן ליקויים במידה ונמצאו</h3>
				</p>
		
				<div>
					<select multiple="multiple" id="lstChks">
					    <option value="eSignNotWorking"> שילוט לא עובד </option>
					    <option value="eSignNotAccurate"> שילוט עובד אבל לא מראה פרטים מדויקים </option>
					    <option value="eElectricityProblem"> אין חשמל בנקודה </option>
					    <option value="eBrokenPoll"> ונדליזם: עמוד שבור </option>
					    <option value="eSignBroken"> ונדליזם: שילוט שבור </option>
					    <option value="eSignDirty"> שילוט מלוכלך </option>
					    <option value="eEnvironmentDirty"> סביבת השילוט והעמוד אינם נקיים </option>
					    <option value="eSolarPanelBroken"> פנל סולרי שבור </option>
					    <option value="eLowBattery"> מצבר נגמר </option>
					</select>
				</div>
				
				
				<p>
					<h3>נא סמן פעולות שבוצעו בעמדה</h3>
				</p>
				
				<div>
					<select multiple="multiple" id="lstActions">
						<option value="eActionSignFixed">שלט תוקן</option>
						<option value="eActionConnectedToServer">חובר לשרת</option>
						<option value="eActionFixedElectricityProblem">תוקנה תקלת חשמל</option>
						<option value="eActionFixedBrokenSign">תוקן שלט שבור</option>
						<option value="eActionFixedPol">תוקן עמוד שבור</option>
						<option value="eActionCleanedSign">נקיון שלט</option>
						<option value="eActionCleanedEnvironment">נקיון כללי בעמדה</option>
						<option value="eActionResetSign">איפוס שלט</option>
						<option value="eActionReplacedSolarPanel">הוחלף פאנל סולארי</option>
						<option value="eActionReplacedBattery">הוחלף מצבר</option>
				    </select>
				    
				</div>
				<div>
					<textarea 	placeholder="הזן טקסט חופשי" lang="he" name="comments" COLS=40 ROWS=6 id="comments" class="textarea" dir="rtl">
				  	</textarea>
				</div>
				
				
				<button type="button" id="btnGetPicture">צלם את העמדה</button>

				<button type="button" id="btnSend">שלח</button>
			</div>
			<!-- /content -->
			<!-- footer -->
			<div data-role="footer">
				<h4>&copy; 2014 ISRCorp</h4>
			</div>
			<!-- /footer -->
		</div>
		<!-- /page1 -->
		
		<!--settings page -->	
		<div data-role="page" id="settings_page" dir="rtl">
			<div data-role="Header">
				<a href="#page1" class="ui-btn-left" data-transition="slide" data-direction="reverse" data-icon="home">Home</a>
				<h1>הגדרות</h1>
			</div>
			
			<div data-role="content">
				<ul data-role="listview">
					<li>
						<a href="#gps" 		data-transition="slide" class="menu">GPS</a>
					</li>
					<li>
						<a href="#setting2" data-transition="slide" class="menu">הגדרות 2</a>
					</li>
					<li>
						<a href="#setting3" data-transition="slide" class="menu">הגדרות 3</a>
					</li>
					<li>
						<a href="#setting4" data-transition="slide" class="menu">הגדרות 4</a>
					</li>
					
					
				</ul>
			</div>
		</div><!--end of settig page -->
		

	</body>
</html>
<script>
	document.addEventListener("deviceReady",onDeviceReady,false);
	
	function onDeviceReady(){
		document.addEventListener("pause",onPause,false);
		document.addEventListener("resume",onResume,false);
		//document.addEventListener("menubutton",doMenu,false); not working??
	
		navigator.splashscreen.hide();
		alert("Device Ready");
	}
	
	
	
	function onPause(){
		alert("Device paused");
	}
	
	function onResume(){
		alert("Device resumed");
	}
	
	function doMenu(){
		console.log("menu clicked");
	}

	document.getElementById("btnSend").onclick = onClickSend;
	
	function onClickSend(){
	
		var stationnumber = document.getElementById("inptStationNumber").value;
		if(isNaN(stationnumber))
		{
			alert("נא הזן מספר תחנה חוקי");
			return;
		}
		
		//start collecting data for sending
		//get selected problems
		var arrSelProblems=$('#lstChks').val();
		var arrSelActions = $('#lstActions').val();
		
		myJson={objSelProbs:{},objSelActions:{}};
		for(var k=0;k<arrSelProblems.length;k++){
		    var objName='obj'+k;
		    var objValue=arrSelProblems[k];
		    myJson.objSelProbs[objName]=objValue;
		}
		for(var k=0;k<arrSelActions.length;k++){
		    var objName='obj'+k;
		    var objValue=arrSelActions[k];
		    myJson.objSelActions[objName]=objValue;
		}
		console.log(JSON.stringify(myJson));		
		alert(JSON.stringify(myJson));
		
		//get freetext
		var freeTxt = $('#comments').val();
//		var jsonFreeText = JSON.parse(freeTxt);
	}
	
	
	document.getElementById("btnGetPicture").onclick = onClickGetPicture;

	function onGetPictureSuccess(imageData) {
	    var image = document.getElementById('myImage');
	    image.src = "data:image/jpeg;base64," + imageData;
	}
	
	function onGetPictureFail(message) {
	    //alert('Failed because: ' + message);
	}	
	
	function onClickGetPicture(){
		navigator.camera.getPicture(onGetPictureSuccess, onGetPictureFail, { quality: 50 }); 
	}
		
	
	
	

</script>