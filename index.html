<!DOCTYPE html>
<html>
	<title>&nbsp;</title>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		
		<!--link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
		<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script-->
		
		
		<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<script type="text/javascript" charset="utf-8" src="EmailComposer.js"></script>
		
	</head>
	
	<body>
		

	
		<!-- Start of first page I -->
		<div data-role="page" id="page1" dir="rtl">
			<!-- Header -->
			<div data-role="header">
				<a href="#settings_page" class="ui-btn-right" data-transition="slide" data-direction="reverse" data-icon="gear">הגדרות</a>
				<!--a href="#testLocation" class="ui-btn-left" data-transition="slide" data-direction="forward" data-icon="search">אתר תחנה</a-->
				<button class="ui-btn-left ui-btn-icon-right" id="btnGetNearestPole" data-icon="search">אתר תחנה</button>
		
				<h1>בדיקת תחנות</h1>

			</div>
  			<div data-role="panel" id="myPanel"> 
    			<h2>Panel Header</h2>
    			<p>You can close the panel by clicking outside the panel, pressing the Esc key or by swiping.</p>
  			</div> 
			<!-- Content    -->

			<div data-role="main" class="ui-content">
				<h3>הזן מספר תחנה</h3>
				<input type="number" step="1" id="inptStationNumber"/> 
				<p>
					<h3>נא סמן ליקויים במידה ונמצאו</h3>
				</p>
		
				<div>
					<select multiple="multiple" id="lstChks">
					    <option value="eSignNotWorking"> שילוט לא עובד </option>
					    <option value="eSignNotAccurate"> שילוט עובד אבל לא מראה פרטים מדויקים </option>
					    <option value="eElectricityProblem"> אין חשמל בנקודה </option>
					    <option value="eBrokenPoll"> ונדליזם: עמוד שבור </option>
					    <option value="eSignBroken"> ונדליזם: שילוט שבור </option>
					    <option value="eSignDirty"> שילוט מלוכלך </option>
					    <option value="eEnvironmentDirty"> סביבת השילוט והעמוד אינם נקיים </option>
					    <option value="eSolarPanelBroken"> פנל סולרי שבור </option>
					    <option value="eLowBattery"> מצבר נגמר </option>
					</select>
				</div>
				
				
				<p>
					<h3>נא סמן פעולות שבוצעו בעמדה</h3>
				</p>
				
				<div>
					<select multiple="multiple" id="lstActions">
						<option value="eActionSignFixed">שלט תוקן</option>
						<option value="eActionConnectedToServer">חובר לשרת</option>
						<option value="eActionFixedElectricityProblem">תוקנה תקלת חשמל</option>
						<option value="eActionFixedBrokenSign">תוקן שלט שבור</option>
						<option value="eActionFixedPol">תוקן עמוד שבור</option>
						<option value="eActionCleanedSign">נקיון שלט</option>
						<option value="eActionCleanedEnvironment">נקיון כללי בעמדה</option>
						<option value="eActionResetSign">איפוס שלט</option>
						<option value="eActionReplacedSolarPanel">הוחלף פאנל סולארי</option>
						<option value="eActionReplacedBattery">הוחלף מצבר</option>
				    </select>
				    
				</div>
				<div>
					<textarea 	placeholder="הזן טקסט חופשי" lang="he" name="comments" COLS=40 ROWS=6 id="comments" class="textarea" dir="rtl">
				  	</textarea>
				</div>
				
				
				<button class="ui-btn-right ui-btn-icon-right" id="btnGetPicture" data-icon="video">צלם תמונה</button>
				<img style="display:none;width:400px;height:400px;" id="smallImage" src="" />
    			<img style="display:none;" id="largeImage" src="" />
				<button type="button" id="btnSend">שלח</button>
			</div>
			<!-- /content -->
			<!-- footer -->
			<div data-role="footer">
				<h4>&copy; 2014 ISRCorp</h4>
			</div>
			<!-- /footer -->
		</div>
		<!-- /page1 -->
		
		<!--settings page -->	
		<div data-role="page" id="settings_page" dir="rtl">
			<div data-role="header">
				<a href="#page1"  class="ui-btn-right" data-transition="slide" data-direction="reverse" data-icon="home">חזרה</a>
				<h1>הגדרות</h1>
			</div>
			
			<div data-role="content">
				<ul data-role="listview">
					<li>
						<a href="#gps" 		data-transition="slide" class="menu" dir="rtl">GPS</a>
					</li>
					<li>
						<a href="#disconnect" data-transition="slide" class="menu">התנתק</a>
					</li>
					<li>
						<a href="#setting3" data-transition="slide" class="menu">הגדרות 3</a>
					</li>
					<li>
						<a href="#setting4" data-transition="slide" class="menu">הגדרות 4</a>
					</li>
					
					
				</ul>
			</div>
		</div><!--end of settig page -->
		
		<div data-role="page" id="testLocation">
			
			<div data-role="content" dir="rtl"> 
				<h3>נתוני עמוד</h3>
			</div>
			
			
		</div><!--end of testlocation page-->
		

	</body>
</html>
<script>

	var pictureSource;   // picture source
    var destinationType; // sets the format of returned value
    var takenPic = "";
    
     
	document.addEventListener("deviceReady",onDeviceReady,false);
	
	
	function onDeviceReady(){
		document.addEventListener("pause",onPause,false);
		document.addEventListener("resume",onResume,false);
		
		pictureSource = navigator.camera.PictureSourceType;
		destinationType = navigator.camera.DestinationType;
	
		navigator.splashscreen.hide();
		//alert("Device Ready");
	}
	
	
	
	function onPause(){
		//alert("Device paused");
	}
	
	function onResume(){
		//alert("Device resumed");
	}
	

	document.getElementById("btnSend").onclick = onClickSend;
	
	function onClickSend(){
	
		var stationnumber = document.getElementById("inptStationNumber").value;
		if(stationnumber=="" || isNaN(stationnumber) )
		{
			alert("נא הזן מספר תחנה חוקי");
			return;
		}
		
		//start collecting data for sending
		//get selected problems
		var arrSelProblems=$('#lstChks').val();
		var arrSelActions = $('#lstActions').val();
		
		myJson={objSelProbs:{},objSelActions:{}};
		if (arrSelProblems != null){
			for(var k=0;k<arrSelProblems.length;k++){
			    var objName='obj'+k;
			    var objValue=arrSelProblems[k];
			    myJson.objSelProbs[objName]=objValue;
			}
		}

		if (arrSelActions != null){
			for(var k=0;k<arrSelActions.length;k++){
			    var objName='obj'+k;
			    var objValue=arrSelActions[k];
			    myJson.objSelActions[objName]=objValue;
			}
		}
		console.log(JSON.stringify(myJson));		
		alert(JSON.stringify(myJson));
		
		
		//get freetext
		var freeTxt = $('#comments').val();
//		var jsonFreeText = JSON.parse(freeTxt);

		//test send picture by mail
		sendPicByMail();
		
		
	}
	
	function sendPicByMail(){
		window.plugins.emailComposer.showEmailComposerWithCallback(function(result){alert("res= " + result);},"testPicByEmail","Bla bla",["yarivzip@gmail.com"],[],[],false,takenPic);
				
	}
	
	document.getElementById("btnGetPicture").onclick = capturePhoto;//getPhoto;capturePhotoEdit;//capturePhoto; //aaa

	function onGetPictureSuccess(imageData) {
	    var image = document.getElementById('myImage');
	    image.src = "data:image/jpeg;base64," + imageData;
	}
	
	
	function onClickGetPicture(){
		var options = "{}";
		navigator.camera.getPicture(onGetPictureSuccess, onGetPictureFail, { quality: 50 });
 
	}
		
	
	/////////////////////////////////////start testing camera//////////////////////////////////////////////////////
	    // Called when a photo is successfully retrieved
    //
    function onPhotoDataSuccess(imageData) {
      // Uncomment to view the base64 encoded image data
       console.log(imageData);

	  //save picture taken for uploading
	  ////takenPic = "data:image/jpeg;base64," + imageData;//data
	  takenPic = imageData;//URI
	  	
      // Get image handle
      var smallImage = document.getElementById('smallImage');

      // Unhide image elements
      smallImage.style.display = 'block';

      // Show the captured photo
      // The inline CSS rules are used to resize the image
      ////smallImage.src = "data:image/jpeg;base64," + imageData;//data
      smallImage.src = imageData;//URI
    }

    // Called when a photo is successfully retrieved
    //
    function onPhotoURISuccess(imageURI) {
      // Uncomment to view the image file URI 
      // console.log(imageURI);

	  //save picture taken for uploading
	  takenPic = imageURI;

      // Get image handle
      //
      var largeImage = document.getElementById('largeImage');

      // Unhide image elements
      //
      largeImage.style.display = 'block';

      // Show the captured photo
      // The inline CSS rules are used to resize the image
      //
      largeImage.src = imageURI;
    }

    // A button will call this function
    //
    function capturePhoto() {
      // Take picture using device camera and retrieve image as base64-encoded string
      //navigator.camera.getPicture(onPhotoDataSuccess, onGetPictureFail, { quality: 50,destinationType: destinationType.DATA_URL });
      navigator.camera.getPicture(onPhotoDataSuccess, onGetPictureFail, { quality: 50,destinationType: destinationType.FILE_URI});
    }

    // A button will call this function
    //
    function capturePhotoEdit() {
      // Take picture using device camera, allow edit, and retrieve image as base64-encoded string  
      navigator.camera.getPicture(onPhotoDataSuccess, onGetPictureFail, { quality: 20, allowEdit: true,destinationType: destinationType.DATA_URL });
    }

    // A button will call this function
    //
    function getPhoto(source) {
      // Retrieve image file location from specified source
      navigator.camera.getPicture(onPhotoURISuccess, onGetPictureFail, { quality: 50,destinationType: destinationType.FILE_URI,pictureSource: PictureSourceType.CAMERA });
    }


	function onGetPictureFail(message) {
	    //alert('Failed because: ' + message);
	}	

	//////////////////////////////////// end testing camera ///////////////////////////////////////////////////////
	
	document.getElementById("btnGetNearestPole").onclick = onGetNearestPoleClick;
	
	function onGetNearestPoleClick(){
		//navigator.geolocation.getCurrentPosition(onGeolocationSuccess,onGeolocationError, {timeout: 30000 });
		navigator.geolocation.getCurrentPosition(onGeolocationSuccess);
	}
	
	function onGeolocationSuccess(position){
		alert('Latitude: '          + position.coords.latitude          + '\n' +
          'Longitude: '         + position.coords.longitude         + '\n' +
          'Altitude: '          + position.coords.altitude          + '\n' +
          'Accuracy: '          + position.coords.accuracy          + '\n' +
          'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
          'Heading: '           + position.coords.heading           + '\n' +
          'Speed: '             + position.coords.speed             + '\n' +
          'Timestamp: '         + position.timestamp                + '\n');
	}
	
	function onGeolocationError(error) {
    alert('code: '    + error.code    + '\n' +
          'message: ' + error.message + '\n');
	}
	
	
	

	

</script>